<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LIFF Ã— Sheets ã‚µãƒ³ãƒ—ãƒ«</title>
  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body>
  <h2>ğŸ“‹ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡</h2>
  <input type="text" id="message" placeholder="ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å…¥åŠ›" />
  <button onclick="submitData()">é€ä¿¡</button>
  <p id="status"></p>

  <script>
    // â˜… è‡ªåˆ†ã®å€¤ã«æ›¸ãæ›ãˆã‚‹
    const LIFF_ID  = "YOUR_LIFF_ID";
    const GAS_URL  = "https://script.google.com/macros/s/YOUR_DEPLOY_ID/exec";

    // LIFFåˆæœŸåŒ–
    liff.init({ liffId: LIFF_ID })
      .then(() => {
        if (!liff.isLoggedIn()) liff.login();
      })
      .catch(err => console.error("LIFF init error:", err));

    // ãƒ‡ãƒ¼ã‚¿é€ä¿¡
    async function submitData() {
      const statusEl = document.getElementById("status");
      statusEl.textContent = "é€ä¿¡ä¸­...";

      try {
        // LINEãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
        const profile = await liff.getProfile();

        const payload = {
          userId:      profile.userId,
          displayName: profile.displayName,
          message:     document.getElementById("message").value
        };

        // GAS WebAppã«POST
        const res = await fetch(GAS_URL, {
          method:  "POST",
          headers: { "Content-Type": "text/plain" }, // GASã®CORSå¯¾ç­–
          body:    JSON.stringify(payload)
        });

        const result = await res.json();
        statusEl.textContent = result.status === "ok"
          ? "âœ… é€ä¿¡å®Œäº†ï¼"
          : "âŒ ã‚¨ãƒ©ãƒ¼: " + result.message;

      } catch (err) {
        statusEl.textContent = "âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: " + err.message;
        console.error(err);
      }
    }
  </script>
</body>
</html>

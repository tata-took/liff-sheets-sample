<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚·ãƒ•ãƒˆæå‡ºæ–‡ç« ä½œæˆãƒ„ãƒ¼ãƒ«</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f5f5;
      padding: 20px 16px;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }

    .header-icon {
      font-size: 32px;
    }

    h1 {
      font-size: 24px;
      color: #5B8EF5;
      font-weight: 600;
    }

    .subtitle {
      color: #666;
      font-size: 14px;
      margin-bottom: 24px;
    }

    .section {
      margin-bottom: 32px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      padding-left: 12px;
      border-left: 4px solid #5B8EF5;
    }

    .preset-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .preset-btn {
      padding: 12px;
      border: 2px solid #5B8EF5;
      background: white;
      color: #5B8EF5;
      border-radius: 24px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preset-btn:active {
      background: #5B8EF5;
      color: white;
    }

    .time-inputs {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .time-input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
      text-align: center;
    }

    .time-separator {
      font-size: 18px;
      color: #666;
    }

    .note {
      font-size: 12px;
      color: #666;
      margin-top: 8px;
    }

    .calendar {
      background: white;
    }

    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }

    .calendar-nav {
      background: none;
      border: none;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
    }

    .calendar-title {
      font-size: 18px;
      font-weight: 600;
    }

    .today-btn {
      padding: 6px 12px;
      background: #f0f0f0;
      border: none;
      border-radius: 6px;
      font-size: 12px;
      cursor: pointer;
    }

    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }

    .calendar-day-header {
      text-align: center;
      font-size: 12px;
      color: #666;
      padding: 8px 0;
      font-weight: 600;
    }

    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .calendar-day:hover {
      background: #f5f5f5;
    }

    .calendar-day.selected {
      background: #EF5B5B;
      color: white;
      border-color: #EF5B5B;
    }

    .calendar-day.today {
      border: 2px solid #333;
      font-weight: 600;
    }

    .calendar-day.empty {
      cursor: default;
      border: none;
    }

    .selected-dates {
      background: #f9f9f9;
      border-radius: 8px;
      padding: 16px;
      min-height: 100px;
    }

    .date-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: white;
      border-radius: 8px;
      margin-bottom: 8px;
    }

    .date-info {
      flex: 1;
    }

    .date-label {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .date-time-edit {
      display: flex;
      gap: 8px;
      font-size: 12px;
    }

    .date-time-edit input {
      width: 60px;
      padding: 4px;
      border: 1px solid #ddd;
      border-radius: 4px;
      text-align: center;
    }

    .delete-btn {
      background: #ff4444;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    .preview-box {
      background: #f9f9f9;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 16px;
      min-height: 150px;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.6;
    }

    .action-buttons {
      display: flex;
      justify-content: center;
      margin-top: 16px;
    }

    .btn {
      padding: 14px 32px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #666;
    }

    .btn:active {
      transform: scale(0.98);
    }

    .empty-state {
      text-align: center;
      color: #999;
      padding: 32px;
      font-size: 14px;
    }

    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 12px 24px;
      border-radius: 24px;
      font-size: 14px;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <span class="header-icon">ğŸ“…</span>
      <h1>ã‚·ãƒ•ãƒˆæå‡ºæ–‡ç« ä½œæˆãƒ„ãƒ¼ãƒ«</h1>
    </div>
    <p class="subtitle">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’é¸æŠã™ã‚‹ã¨ã€æå‡ºç”¨ã®æ–‡ç« ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™</p>

    <!-- 1. ã‚ˆãä½¿ã†æ™‚é–“è¨­å®š -->
    <div class="section">
      <div class="section-title">1. ã‚ˆãä½¿ã†æ™‚é–“è¨­å®š</div>
      <div class="preset-buttons">
        <button class="preset-btn" onclick="setPreset('17:00', '21:00')">17æ™‚ï½21æ™‚</button>
        <button class="preset-btn" onclick="setPreset('21:00', '24:00')">21æ™‚ï½24æ™‚</button>
        <button class="preset-btn" onclick="setPreset('18:00', '22:00')">18æ™‚ï½22æ™‚</button>
        <button class="preset-btn" onclick="setPreset('09:00', '13:00')">9æ™‚ï½13æ™‚</button>
      </div>
      <div class="time-inputs">
        <input type="time" id="startTime" class="time-input" value="21:00">
        <span class="time-separator">ï½</span>
        <input type="time" id="endTime" class="time-input" value="24:00">
      </div>
      <p class="note">â€» ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§é¸æŠã—ãŸæ—¥ã«ã€ã“ã®æ™‚é–“ãŒè‡ªå‹•ã§è¨­å®šã•ã‚Œã¾ã™</p>
    </div>

    <!-- 2. æ—¥ä»˜é¸æŠ -->
    <div class="section">
      <div class="section-title">2. æ—¥ä»˜é¸æŠ</div>
      <div class="calendar">
        <div class="calendar-header">
          <button class="calendar-nav" onclick="changeMonth(-1)">â—€</button>
          <span class="calendar-title" id="calendarTitle">2026å¹´ 2æœˆ</span>
          <button class="today-btn" onclick="goToToday()">ä»Šæ—¥</button>
          <button class="calendar-nav" onclick="changeMonth(1)">â–¶</button>
        </div>
        <div class="calendar-grid" id="calendar"></div>
      </div>
    </div>

    <!-- 3. é¸æŠã—ãŸæ—¥ç¨‹ -->
    <div class="section">
      <div class="section-title">3. é¸æŠã—ãŸæ—¥ç¨‹ï¼ˆå€‹åˆ¥èª¿æ•´å¯ï¼‰</div>
      <div class="selected-dates" id="selectedDates">
        <div class="empty-state">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
      </div>
    </div>

    <!-- 4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
    <div class="section">
      <div class="section-title">4. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</div>
      <div class="preview-box" id="preview">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</div>
      <div class="action-buttons">
        <button class="btn btn-secondary" onclick="clearAll()">ğŸ—‘ï¸ å…¨å‰Šé™¤</button>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const LIFF_ID = "2009181333-kAltbUfR";  // â˜… å¤‰æ›´å¿…è¦
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxnqPx5wP3kdddUhWItMc0NEodD6tWwIhGOYyr5X_dBrb_zzetAb3Sk0a0ZF5psZ_ksCA/exec";   // â˜… å¤‰æ›´å¿…è¦

    let currentDate = new Date();
    let selectedDates = [];

    // LIFFåˆæœŸåŒ–
    liff.init({ liffId: LIFF_ID })
      .then(() => {
        if (!liff.isLoggedIn()) liff.login();
        renderCalendar();
      })
      .catch(err => console.error("LIFF init error:", err));

    // ãƒ—ãƒªã‚»ãƒƒãƒˆæ™‚é–“è¨­å®š
    function setPreset(start, end) {
      document.getElementById('startTime').value = start;
      document.getElementById('endTime').value = end;
    }

    // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼æç”»
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      document.getElementById('calendarTitle').textContent = 
        `${year}å¹´ ${month + 1}æœˆ`;

      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();
      const today = new Date();

      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';

      // æ›œæ—¥ãƒ˜ãƒƒãƒ€ãƒ¼
      const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
      days.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        calendar.appendChild(header);
      });

      // ç©ºç™½
      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement('div');
        empty.className = 'calendar-day empty';
        calendar.appendChild(empty);
      }

      // æ—¥ä»˜
      for (let date = 1; date <= lastDate; date++) {
        const day = document.createElement('div');
        day.className = 'calendar-day';
        day.textContent = date;

        const fullDate = new Date(year, month, date);
        const dateStr = formatDate(fullDate);

        if (fullDate.toDateString() === today.toDateString()) {
          day.classList.add('today');
        }

        if (selectedDates.some(d => d.date === dateStr)) {
          day.classList.add('selected');
        }

        day.onclick = () => toggleDate(fullDate);
        calendar.appendChild(day);
      }
    }

    // æ—¥ä»˜é¸æŠãƒˆã‚°ãƒ«
    function toggleDate(date) {
      const dateStr = formatDate(date);
      const index = selectedDates.findIndex(d => d.date === dateStr);

      if (index > -1) {
        selectedDates.splice(index, 1);
      } else {
        const startTime = document.getElementById('startTime').value;
        const endTime = document.getElementById('endTime').value;
        
        selectedDates.push({
          date: dateStr,
          dayOfWeek: getDayOfWeek(date),
          startTime: startTime,
          endTime: endTime
        });
      }

      selectedDates.sort((a, b) => new Date(a.date) - new Date(b.date));
      renderCalendar();
      renderSelectedDates();
      updatePreview();
      saveToGAS();
    }

    // é¸æŠæ—¥ç¨‹ãƒªã‚¹ãƒˆæç”»
    function renderSelectedDates() {
      const container = document.getElementById('selectedDates');
      
      if (selectedDates.length === 0) {
        container.innerHTML = '<div class="empty-state">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„</div>';
        return;
      }

      container.innerHTML = selectedDates.map((item, index) => `
        <div class="date-item">
          <div class="date-info">
            <div class="date-label">${item.date} (${item.dayOfWeek})</div>
            <div class="date-time-edit">
              <input type="time" value="${item.startTime}" 
                     onchange="updateTime(${index}, 'startTime', this.value)">
              <span>ï½</span>
              <input type="time" value="${item.endTime}" 
                     onchange="updateTime(${index}, 'endTime', this.value)">
            </div>
          </div>
          <button class="delete-btn" onclick="deleteDate(${index})">å‰Šé™¤</button>
        </div>
      `).join('');
    }

    // æ™‚é–“æ›´æ–°
    function updateTime(index, field, value) {
      selectedDates[index][field] = value;
      updatePreview();
      saveToGAS();
    }

    // æ—¥ä»˜å‰Šé™¤
    function deleteDate(index) {
      selectedDates.splice(index, 1);
      renderCalendar();
      renderSelectedDates();
      updatePreview();
      saveToGAS();
    }

    // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ›´æ–°
    function updatePreview() {
      const preview = document.getElementById('preview');

      if (selectedDates.length === 0) {
        preview.textContent = 'ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‹ã‚‰æ—¥ä»˜ã‚’é¸æŠã—ã¦ãã ã•ã„';
        return;
      }

      const lines = selectedDates.map(item => {
        const start = item.startTime.replace(':', 'æ™‚') + 'åˆ†';
        const end = item.endTime.replace(':', 'æ™‚') + 'åˆ†';
        return `${item.date}(${item.dayOfWeek}) ${start}ã€œ${end}`;
      });

      preview.textContent = lines.join('\n');
    }

    // GASã«è‡ªå‹•ä¿å­˜
    async function saveToGAS() {
      if (selectedDates.length === 0) return;

      try {
        const profile = await liff.getProfile();
        const text = document.getElementById('preview').textContent;

        await fetch(GAS_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'text/plain' },
          body: JSON.stringify({
            userId: profile.userId,
            displayName: profile.displayName,
            message: text,
            dates: selectedDates
          })
        });
      } catch (err) {
        console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', err);
      }
    }

    // å…¨å‰Šé™¤
    function clearAll() {
      if (confirm('å…¨ã¦ã®é¸æŠã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹?')) {
        selectedDates = [];
        renderCalendar();
        renderSelectedDates();
        updatePreview();
        showToast('å…¨å‰Šé™¤ã—ã¾ã—ãŸ');
      }
    }

    // æœˆå¤‰æ›´
    function changeMonth(delta) {
      currentDate.setMonth(currentDate.getMonth() + delta);
      renderCalendar();
    }

    // ä»Šæ—¥ã«ç§»å‹•
    function goToToday() {
      currentDate = new Date();
      renderCalendar();
    }

    // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      setTimeout(() => toast.classList.remove('show'), 2000);
    }

    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    function formatDate(date) {
      const y = date.getFullYear();
      const m = String(date.getMonth() + 1).padStart(2, '0');
      const d = String(date.getDate()).padStart(2, '0');
      return `${y}/${m}/${d}`;
    }

    function getDayOfWeek(date) {
      const days = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
      return days[date.getDay()];
    }
  </script>
</body>
</html>
